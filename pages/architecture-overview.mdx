# Architectural Overview: Using OxideAuth as a Central Authentication Provider

In a microservices architecture, **OxideAuth** serves as a centralized authentication provider that handles user authentication, authorization, and token management. Client requests to microservices are authenticated and authorized using tokens generated by OxideAuth. This approach ensures that all services share a unified authentication layer.

---

## **How OxideAuth Fits into Your Microservices Architecture**

In this model, **OxideAuth** acts as the single point of truth for authentication and authorization. When a client interacts with any microservice, the following flow is generally followed:

1. **Client Authentication via OxideAuth**:

   - The client first interacts with OxideAuth by sending login or registration requests.
   - Upon successful authentication, OxideAuth issues a **JWT (Bearer Token)**, which is returned to the client.

2. **Client Requests to Microservices**:

   - The client includes the **Bearer Token** in the `Authorization` header when making requests to any microservice.
   - The microservice does not directly manage authentication but instead verifies the token with OxideAuth.

3. **Microservice Verifies Token via OxideAuth**:

   - Upon receiving the request, the microservice extracts the client's JWT from the `Authorization` header.
   - The microservice then sends a validation request to OxideAuth using **its own service account token** in the `Authorization` header. The client's JWT and required permissions are included in the JSON body of the request.
   - OxideAuth validates the client token and checks if the client has the necessary permissions to access the requested resource. It responds with either a valid or not valid result, ensuring the validation payload is lightweight.

   ### Request from Microservice to OxideAuth

   **Method**: `POST`  
   **URL**: `/auth/validate-token`  
   **Headers**:

   - `Authorization: Bearer {service_account_token}`

   **Body**:

   ```json
   {
     "token": "client_jwt_token_here",
     "permissions": ["service.data.read"]
   }
   ```

   ### Example Response from OxideAuth:

   ```json
   {
     "valid": true,
     "user_id": "user_123",
     "roles": ["admin", "user"]
   }
   ```

4. **Microservice Responds to the Client**:

   - If OxideAuth confirms that the client's token is valid and they have the required permissions, the microservice processes the request and sends the appropriate response to the client.
   - If the client's token is invalid or the required permissions are missing, the microservice responds with a 401 Unauthorized error.

   ### Example Response to Client:

   ```json
   {
     "data": "Protected data"
   }
   ```

---

## **System Workflow Example**

Hereâ€™s a step-by-step example of how OxideAuth fits into the workflow of a typical microservice architecture:

1. **User Login/Registration**:

   - The client sends a request to the `/auth/login` or `/auth/register` endpoint of OxideAuth.
   - OxideAuth verifies the credentials and issues a JWT token if the credentials are valid.

   Example Response:

   ```json
   {
     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
   }
   ```

2. **Client Requests a Microservice**:

   - The client sends a request to a protected microservice endpoint, including the JWT token in the `Authorization` header.

   Example Request to a Microservice:

   ```http
   GET /service/data
   Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

3. **Microservice Verifies the Token via OxideAuth**:

   - The microservice sends a request to OxideAuth with its **own service account token** in the `Authorization` header.
   - The microservice includes the **client's token** and the **permissions** required to access the requested resource in the JSON body.
   - OxideAuth responds with a validation result indicating whether the client token is valid and whether the user has the necessary permissions.

   Example Request to OxideAuth:

   ```http
   POST /auth/validate-token
   Authorization: Bearer {service_account_token}
   Content-Type: application/json
   ```

   Request Body:

   ```json
   {
     "token": "client_jwt_token_here",
     "permissions": ["service.data.read"]
   }
   ```

   Example Response from OxideAuth:

   ```json
   {
     "valid": true,
     "user_id": "user_123",
     "roles": ["admin", "user"]
   }
   ```

4. **Microservice Responds to the Client**:

   - If OxideAuth confirms that the client's token is valid and they have the necessary permissions, the microservice processes the request and returns a successful response.
   - If the token is invalid or permissions are missing, the microservice responds with a `401 Unauthorized` error.

   Example Response to Client:

   ```json
   {
     "data": "Protected data"
   }
   ```

---

## **Benefits of Using OxideAuth as Central Auth Provider**

- **Single Point of Authentication**: By centralizing authentication in OxideAuth, all microservices can rely on a single, consistent authentication provider, reducing duplication of code and potential security vulnerabilities.
- **Token-Based Authentication**: JWT tokens are stateless, making them lightweight and efficient for distributed architectures. Microservices can easily verify tokens without needing to store session state.

- **Scalability**: Microservices can scale independently while maintaining secure communication with OxideAuth for authentication. This makes the architecture flexible and scalable for large systems.

- **Simplified Permission Management**: OxideAuth allows centralized management of roles and permissions. Each microservice can focus on its core logic without handling role-based access control (RBAC) directly.

---

## **Best Practices**

- **Secure Token Transmission**: Always transmit JWT tokens over HTTPS to prevent token theft via man-in-the-middle (MITM) attacks.
- **Token Expiration**: Ensure that JWT tokens have a reasonable expiration time. Implement token refresh mechanisms using the `/auth/refresh-token` endpoint.
- **Role and Permission Validation**: Microservices should verify not only the validity of the token but also ensure that the token grants the necessary permissions to access specific resources.
- **Error Handling**: If the token is invalid or expired, microservices should handle the 401 Unauthorized response gracefully by prompting the user to log in again.

---

## **OxideAuth in Action: Example System Architecture**

- **Client**: Makes requests to microservices and authenticates through OxideAuth.
- **OxideAuth**: Central authentication provider managing login, token validation, and permissions.
- **Microservices**: Each microservice communicates with OxideAuth to validate tokens and perform access control.

---

By integrating **OxideAuth** into your microservice architecture, you ensure that all services share a consistent, secure, and scalable authentication layer.
